"use strict";const urlBase="https://api.tvmaze.com/search/shows?q=",ulElem=document.querySelector(".tvShows-list"),favElem=document.querySelector("#favouritesList"),inputValue=document.querySelector(".searchInput"),searchButton=document.querySelector(".buttonSearch"),deleteButton=document.querySelector(".delete-all_button"),title=document.getElementById("main-title");let tvShowsList=[],localStorageFavourites=readLocalStorage();function conectToApi(){const e=inputValue.value;ulElem.innerHTML="",fetch(`${urlBase}`+e).then(e=>e.json()).then(e=>{tvShowsList=e,printTvShows(tvShowsList)})}function conectToApiIfEnter(e){13===e.keyCode&&conectToApi()}function printTvShows(e){for(let t of e){const e=document.createElement("li");e.setAttribute("id",t.show.id),e.setAttribute("class","tvShow-list_item");const o=document.createElement("img");o.setAttribute("alt","Poster");const a=document.createElement("p");a.setAttribute("class","show-title");let l=document.createTextNode(t.show.name);a.appendChild(l),e.appendChild(o),e.appendChild(a),ulElem.appendChild(e),null!==t.show.image?o.setAttribute("src",t.show.image.medium):o.setAttribute("src","https://via.placeholder.com/210x295/575352/ffffff/?text=TV"),-1!==obtainIndexOfLocalStorageFavouritesById(t.show.id)&&e.setAttribute("class","tvShow-list_item tvShowSelected")}title.classList.add("titleMove"),title.classList.remove("titleOnLoad"),addClickListeners()}function obtainIndexOfLocalStorageFavouritesById(e){for(let t=0;t<localStorageFavourites.length;t++)if(parseInt(e)===localStorageFavourites[t].show.id)return t;return-1}function addClickListeners(){const e=document.querySelectorAll(".tvShow-list_item");for(let t of e)t.addEventListener("click",saveAndDeleteFavourites)}function setLocalStorage(e){localStorage.setItem("tvShowInfo",JSON.stringify(e))}function readLocalStorage(){let e=JSON.parse(localStorage.getItem("tvShowInfo"));return null!==e?e:[]}function getTvShowObject(e){return tvShowsList.find(t=>t.show.id===parseInt(e))}function saveAndDeleteFavourites(e){const t=e.currentTarget.id,o=getTvShowObject(t);-1===obtainIndexOfLocalStorageFavouritesById(t)?(localStorageFavourites.push(o),tvShowSelectedStyle(t)):deleteFavouriteById(t),setLocalStorage(localStorageFavourites),renderFavourites(localStorageFavourites)}function tvShowSelectedStyle(e){document.getElementById(e).classList.toggle("tvShowSelected")}function renderFavourites(e){favElem.innerHTML="";for(let t of e){const e=document.createElement("li");e.setAttribute("id",t.show.id),e.setAttribute("class","fav-list_item");const o=document.createElement("img");o.setAttribute("alt","Poster");const a=document.createElement("p");let l=document.createTextNode(t.show.name);a.appendChild(l);const n=document.createElement("span");n.setAttribute("class","close"),n.innerHTML=" &times;",a.appendChild(n),e.appendChild(o),e.appendChild(a),favElem.appendChild(e),null!==t.show.image?o.setAttribute("src",t.show.image.medium):o.setAttribute("src","https://via.placeholder.com/210x295/575352/ffffff/?text=TV"),addRemoveFavouriteListeners()}}function addRemoveFavouriteListeners(){const e=document.getElementsByClassName("close");for(let t of e)t.addEventListener("click",deleteFavouriteAside)}function deleteFavouriteAside(e){deleteFavouriteById(e.currentTarget.parentElement.parentElement.id)}function deleteFavouriteById(e){const t=obtainIndexOfLocalStorageFavouritesById(e);localStorageFavourites.splice(t,1),tvShowSelectedStyle(e),setLocalStorage(localStorageFavourites),renderFavourites(localStorageFavourites)}function deleteAllFavourites(){for(let e of localStorageFavourites)tvShowSelectedStyle(e.show.id);favElem.innerHTML="",setLocalStorage([]),localStorageFavourites=readLocalStorage()}searchButton.addEventListener("click",conectToApi),document.addEventListener("keydown",conectToApiIfEnter),window.addEventListener("load",renderFavourites(localStorageFavourites)),deleteButton.addEventListener("click",deleteAllFavourites);